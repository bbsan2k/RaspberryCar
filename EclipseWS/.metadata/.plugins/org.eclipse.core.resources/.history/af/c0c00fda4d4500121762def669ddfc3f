import web
import threading
from web import form
import DriveHandler
from SimpleXMLRPCServer import SimpleXMLRPCServer as Server

## Drivehandler

handler = DriveHandler.driveHandler()

## SimpleXMLRPCServer Part

def drive(direction):
    handler.drive(direction)


    
## Web.py Part

render = web.template.render('templates/')

driveForm = form.Form(
              form.Button(type="submit", name = "button", html="Forward", value="fwd"),
              form.Button(type="submit", name = "button", html="Right", value="rgt"),
              form.Button(type="submit", name = "button", html="Left", value="lft"),
              form.Button(type="submit", name = "button", html ="Stop", value="stp")        )

class webServer(threading.Thread):  
    def run(self):
        urls = ('/', 'index')
        app = web.application(urls, globals())

        app.run
        
    def GET(self):
        form = driveForm()
        return render.formtest(driveForm)
    def POST(self):
        i = web.input()
        if (i.button == "fwd"):
            handler.drive("fwd")
        elif (i.button == "rgt"):
            handler.drive("right")
        elif (i.button == "lft"):
            handler.drive("left")
        elif (i.button == "stp"):
            handler.drive("stop")
        return render.formtest(driveForm)
        

class rpcServer(threading.Thread):
    rpcSrv = Server(("",1339))
    rpcSrv.register_function(drive)
    print("RPC up and running")
    rpcSrv.serve_forever()


if __name__ == "__main__":
    webServer.start()
    rpcServer.start()
    
    
    ##setUpRpc()
    ##app.run()




